<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Login · Luve Coffee Roastery</title>
<link rel="icon" href="assets/favicon.svg"><link rel="stylesheet" href="styles.css">
<script defer src="script.js"></script>
<script defer src="auth.js"></script>
<script defer>
  function showTab(tab){
    document.querySelectorAll('[data-tab]').forEach(el=> el.style.display='none');
    document.getElementById(tab).style.display='block';
    document.querySelectorAll('.tab').forEach(t=> t.setAttribute('aria-selected','false'));
    document.querySelector(`[data-tab-btn="${tab}"]`).setAttribute('aria-selected','true');
  }
  document.addEventListener('DOMContentLoaded',()=>{
    showTab('loginTab');
    const params = new URLSearchParams(location.search);
    const ret = params.get('return');
    // Login submit
    document.getElementById('loginForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const id = document.getElementById('loginId').value.trim();
      const pw = document.getElementById('loginPw').value;
      const remember = document.getElementById('remember').checked;
      const u = getUserByEmailOrUsername(id);
      if(!u || u.password !== pw){ alert('Invalid credentials.'); return; }
      loginSession(u.email, remember);
      location.href = ret==='cart' ? 'cart.html' : 'account.html';
    });
    // Register submit
    document.getElementById('regForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const username = document.getElementById('regUser').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const pw = document.getElementById('regPw').value;
      if(!username || !email || !pw){ alert('Please fill all fields.'); return; }
      if(getUserByEmailOrUsername(email)){ alert('Email already registered.'); return; }
      const user = ensureSampleOrders({ username, email, password: pw, orders: [] });
      upsertUser(user);
      alert('Account created. You can now log in.');
      showTab('loginTab');
    });
  });
</script>
</head>
<body>
<header class="site-header">
  <div class="container nav">
    <a class="brand" href="index.html"><span class="logo"></span><span>Luve Coffee Roastery</span></a>
    <nav class="links">
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="shop.html">Shop</a>
      <a id="cartLink" href="cart.html">Cart</a>
    </nav>
    <div class="nav-right">
      <a id="accountLink" class="account-link" href="login.html">Login</a>
      <button class="theme-toggle" data-action="toggle-theme" aria-pressed="false" title="Toggle theme">
        <img id="theme-icon" src="assets/icon-moon.svg" alt="" width="18" height="18"/><span id="theme-label">Dark</span>
      </button>
    </div>
  </div>
</header>
<main class="container section">
  <h1>My Account</h1>
  <div class="auth-wrap">
    <section class="auth-card">
      <div class="tab-row">
        <button class="tab" data-tab-btn="loginTab" onclick="showTab('loginTab')" aria-selected="true">Login</button>
        <button class="tab" data-tab-btn="registerTab" onclick="showTab('registerTab')">Register</button>
      </div>
      <div id="loginTab" data-tab>
        <form id="loginForm">
          <label>Username or email</label>
          <input id="loginId" type="text" autocomplete="username" required>
          <label>Password</label>
          <input id="loginPw" type="password" autocomplete="current-password" required>
          <div class="form-row">
            <label style="display:flex;align-items:center;gap:.4rem"><input type="checkbox" id="remember"> Remember Me</label>
            <a class="muted" href="#" onclick="alert('Password reset is a demo.');return false;">Lost your password?</a>
          </div>
          <div class="cta-row" style="margin-top:1rem">
            <button class="btn primary" type="submit">Login</button>
          </div>
        </form>
      </div>
      <div id="registerTab" data-tab style="display:none">
        <form id="regForm">
          <label>Username</label>
          <input id="regUser" type="text" required>
          <label>Email address</label>
          <input id="regEmail" type="email" required>
          <label>Password</label>
          <input id="regPw" type="password" required>
          <div class="cta-row" style="margin-top:1rem">
            <button class="btn primary" type="submit">Register</button>
          </div>
        </form>
      </div>
    </section>
    <aside class="auth-card">
      <h2>Benefits</h2>
      <p class="muted">Track orders, manage addresses, and check out faster next time.</p>
      <ul>
        <li>View your order history</li>
        <li>Save your preferences</li>
        <li>Fast, secure checkout</li>
      </ul>
      <p class="badge">Demo only · No real payments</p>
    </aside>
  </div>
</main>
<footer class="site-footer"><div class="container muted">© <span id="y"></span> Luve Coffee Roastery</div>
<script>document.getElementById('y').textContent = new Date().getFullYear();</script></footer>
</body></html>